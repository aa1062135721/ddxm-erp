(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4696d306"],{"0e43":function(e,t,a){},"1af6":function(e,t,a){var o=a("63b6");o(o.S,"Array",{isArray:a("9003")})},"1e31":function(e,t,a){"use strict";var o=a("0e43"),n=a.n(o);n.a},"20fd":function(e,t,a){"use strict";var o=a("d9f6"),n=a("aebd");e.exports=function(e,t,a){t in e?o.f(e,t,n(0,a)):e[t]=a}},"2d23":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"crumbs"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[e._v("破损单")])],1)],1),a("div",{staticClass:"container"},[a("div",{staticClass:"search-div"},[a("el-select",{staticClass:"my-input",attrs:{placeholder:"状态",clearable:""},model:{value:e.requestData.status,callback:function(t){e.$set(e.requestData,"status",t)},expression:"requestData.status"}},[a("el-option",{attrs:{label:"待审核",value:"1"}}),a("el-option",{attrs:{label:"审核通过",value:"2"}}),a("el-option",{attrs:{label:"审核不通过",value:"3"}})],1),a("el-input",{staticClass:"my-input",staticStyle:{width:"250px"},attrs:{clearable:"",placeholder:"商品名称|条形码"},model:{value:e.requestData.search_val,callback:function(t){e.$set(e.requestData,"search_val",t)},expression:"requestData.search_val"}}),a("el-input",{staticClass:"my-input",staticStyle:{width:"250px"},attrs:{clearable:"",placeholder:"订单号"},model:{value:e.requestData.dl_sn,callback:function(t){e.$set(e.requestData,"dl_sn",t)},expression:"requestData.dl_sn"}}),a("depot",{model:{value:e.requestData.warehouse_id,callback:function(t){e.$set(e.requestData,"warehouse_id",t)},expression:"requestData.warehouse_id"}})],1),a("div",[a("el-button",{attrs:{type:"primary"},on:{click:e.getList}},[e._v("搜索")]),a("el-button",{attrs:{type:"primary",plain:""}},[e._v("导出")]),a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){e.addDialog.isShow=!0}}},[e._v("新增破损单")])],1),a("div",{staticStyle:{margin:"40px 0"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.responseData.data,border:""}},[a("el-table-column",{attrs:{label:"序号",type:"index"}}),a("el-table-column",{attrs:{label:"仓库",prop:"warehouse_name"}}),a("el-table-column",{attrs:{label:"申请人",prop:"applicant_name"}}),a("el-table-column",{attrs:{label:"申请时间",prop:"create_time"}}),a("el-table-column",{attrs:{label:"审核时间",prop:"update_time"}}),a("el-table-column",{attrs:{label:"商品名称",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.items,(function(t,o){return a("div",{key:o},[e._v(e._s(t.title))])}))}}])}),a("el-table-column",{attrs:{label:"商品条形码",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.items,(function(t,o){return a("div",{key:o},[e._v(e._s(t.bar_code))])}))}}])}),a("el-table-column",{attrs:{label:"商品规格"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.items,(function(t,o){return a("div",{key:o},[e._v(e._s(t.attr_name))])}))}}])}),a("el-table-column",{attrs:{label:"破损数量"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.items,(function(t,o){return a("div",{key:o},[e._v(e._s(t.num))])}))}}])}),a("el-table-column",{attrs:{label:"破损原因",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.items,(function(t,o){return a("div",{key:o},[e._v("\n                            "+e._s(t.reason)+"\n                        ")])}))}}])}),a("el-table-column",{attrs:{label:"状态",prop:"status_name"}}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.examineDialogShow(t.row.id)}}},[e._v("审核")])]}}])})],1)],1),a("div",[a("el-pagination",{attrs:{total:e.responseData.count,background:"",layout:"prev, pager, next"},on:{"current-change":e.handleCurrentChange}})],1)]),a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],staticClass:"send-goods-dialog",attrs:{title:"新增破损单",center:"",visible:e.addDialog.isShow,width:"50%"},on:{"update:visible":function(t){return e.$set(e.addDialog,"isShow",t)}}},[a("div",{staticStyle:{"margin-bottom":"10px"}},[a("depot",{model:{value:e.addDialog.requestData.warehouse_id,callback:function(t){e.$set(e.addDialog.requestData,"warehouse_id",t)},expression:"addDialog.requestData.warehouse_id"}}),a("el-button",{attrs:{type:"primary"},on:{click:e.addDialogGetChoosesGoodsDialogShow}},[e._v("选择商品")])],1),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.addDialog.requestData.items,border:"","max-height":"400"}},[a("el-table-column",{attrs:{type:"index",label:"序号"}}),a("el-table-column",{attrs:{prop:"title",label:"商品名称"}}),a("el-table-column",{attrs:{prop:"bar_code",label:"条形码"}}),a("el-table-column",{attrs:{prop:"attr_name",label:"规格"}}),a("el-table-column",{attrs:{label:"图片"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("el-image",{staticClass:"table-td-thumb",staticStyle:{width:"50px",height:"50px",margin:"10px"},attrs:{src:e.row.pic,"preview-src-list":[e.row.pic]}})]}}])}),a("el-table-column",{attrs:{prop:"kuchun",label:"库存"}}),a("el-table-column",{attrs:{label:"破损数量"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{model:{value:t.row.num,callback:function(a){e.$set(t.row,"num",a)},expression:"scope.row.num"}})]}}])}),a("el-table-column",{attrs:{label:"原因"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{model:{value:t.row.reason,callback:function(a){e.$set(t.row,"reason",a)},expression:"scope.row.reason"}})]}}])})],1),a("div",{staticStyle:{"margin-top":"50px","text-align":"center"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.addDialogSubmit}},[e._v("提交")])],1)],1),a("choosesGoods",{attrs:{visible:e.addDialog.choosesGoodsDialog.isShow,requestData:{warehouse_id:e.addDialog.requestData.warehouse_id}},on:{"update:visible":function(t){return e.$set(e.addDialog.choosesGoodsDialog,"isShow",t)},sendChoosesGoods:e.addDialogGetChoosesGoods}}),a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"审核",center:"",visible:e.examineDialog.isShow,width:"30%"},on:{"update:visible":function(t){return e.$set(e.examineDialog,"isShow",t)}}},[a("el-form",{ref:"examineDialog",attrs:{model:e.examineDialog.requestData,rules:e.examineDialog.rules,"label-width":"150px"}},[a("el-form-item",{attrs:{label:"审核状态",prop:"status"}},[a("el-radio-group",{model:{value:e.examineDialog.requestData.status,callback:function(t){e.$set(e.examineDialog.requestData,"status",t)},expression:"examineDialog.requestData.status"}},[a("el-radio",{attrs:{label:"2"}},[e._v("同意")]),a("el-radio",{attrs:{label:"3"}},[e._v("拒绝")])],1)],1),a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.examineDialog.requestData.examine_reason,callback:function(t){e.$set(e.examineDialog.requestData,"examine_reason",t)},expression:"examineDialog.requestData.examine_reason"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.examineDialogSubmit("examineDialog")}}},[e._v("确定")]),a("el-button",{on:{click:function(t){return e.examineDialogCancel("examineDialog")}}},[e._v("取消")])],1)],1)],1)],1)},n=[],r=(a("ac4d"),a("8a81"),a("ac6a"),a("75fc")),i=a("b775"),s=function(e){return Object(i["a"])({url:"/warehouse/damage_list/getList",method:"post",data:e})},l=function(e){return Object(i["a"])({url:"/warehouse/damage_list/add",method:"post",data:e})},u=function(e){return Object(i["a"])({url:"/warehouse/damage_list/examine",method:"post",data:e})},c=a("aa1f"),d=a("89ed"),h={name:"index",data:function(){return{requestData:{dl_sn:"",status:"",warehouse_id:"",search_val:"",page:1,limit:10},responseData:{count:0,data:[]},addDialog:{isShow:!1,requestData:{warehouse_id:"",items:[]},choosesGoodsDialog:{isShow:!1}},examineDialog:{isShow:!1,rules:{status:[{required:!0,message:"请同意或拒绝",trigger:"blur"}]},requestData:{id:"",status:"",examine_reason:""}}}},watch:{"addDialog.requestData.warehouse_id":function(e,t){this.addDialog.requestData.items=[]}},methods:{resetForm:function(e){this.$refs[e].resetFields()},getList:function(){var e=this;s(this.requestData).then((function(t){200===t.code&&(e.responseData=t.data)})).catch((function(e){console.log(e)}))},handleCurrentChange:function(e){this.requestData.page=e,this.getList()},addDialogGetChoosesGoodsDialogShow:function(){this.addDialog.requestData.warehouse_id?this.addDialog.choosesGoodsDialog.isShow=!0:this.$message.error("请选择仓库")},addDialogGetChoosesGoods:function(e){var t=[],a=[],o=!0,n=!1,i=void 0;try{for(var s,l=e[Symbol.iterator]();!(o=(s=l.next()).done);o=!0){var u=s.value;t.push({item_id:u.id,title:u.g_title,pic:u.imgurl,attr_ids:u.key,attr_name:u.key_name,bar_code:u.code,reason:"",kuchun:u.w_stock,num:""})}}catch(d){n=!0,i=d}finally{try{o||null==l.return||l.return()}finally{if(n)throw i}}a=[].concat(Object(r["a"])(this.addDialog.requestData.items),t);var c={};this.addDialog.requestData.items=a.reduce((function(e,t){return!c[t.item_id+t.attr_ids]&&(c[t.item_id+t.attr_ids]=e.push(t)),e}),[])},addDialogSubmit:function(){var e=this,t=!1;if(this.addDialog.requestData.warehouse_id){var a=!0,o=!1,n=void 0;try{for(var r,i=this.addDialog.requestData.items[Symbol.iterator]();!(a=(r=i.next()).done);a=!0){var s=r.value;if(parseInt(s.num)<=0||parseInt(s.num)>parseInt(s.kuchun)){this.$message.error("【".concat(s.title,"】的破损数量有误！")),t=!0;break}}}catch(u){o=!0,n=u}finally{try{a||null==i.return||i.return()}finally{if(o)throw n}}t||l(this.addDialog.requestData).then((function(t){200===t.code&&(e.getList(),e.addDialog.isShow=!1,e.$message.success("新增破损单成功"),e.addDialog.requestData={warehouse_id:"",items:[]})})).catch((function(e){console.log(e)}))}else this.$message.error("请选择仓库")},examineDialogShow:function(e){this.examineDialog.requestData.id=e,this.examineDialog.isShow=!0},examineDialogSubmit:function(e){var t=this;this.$refs[e].validate((function(a){if(!a)return!1;u(t.examineDialog.requestData).then((function(a){200==a.code&&(t.getList(),t.$message.success("审核成功"),t.resetForm(e),t.examineDialog.isShow=!1)}))}))},examineDialogCancel:function(e){this.resetForm(e),this.examineDialog.isShow=!1}},beforeMount:function(){this.getList()},components:{depot:c["default"],choosesGoods:d["default"]}},f=h,m=(a("c680"),a("2877")),p=Object(m["a"])(f,o,n,!1,null,"7b48c1b9",null);t["default"]=p.exports},"4ff7":function(e,t,a){"use strict";a.d(t,"d",(function(){return n})),a.d(t,"e",(function(){return r})),a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return s})),a.d(t,"c",(function(){return l}));var o=a("b775"),n=function(e){return Object(o["a"])({url:"/warehouse/warehouse_manage/getList",method:"post",data:e})},r=function(e){return Object(o["a"])({url:"/system/common/getWarehouse",method:"post",data:e})},i=function(e){return Object(o["a"])({url:"/warehouse/warehouse_manage/add",method:"post",data:e})},s=function(e){return Object(o["a"])({url:"/warehouse/warehouse_manage/del",method:"post",data:e})},l=function(e){return Object(o["a"])({url:"/warehouse/warehouse_manage/edit",method:"post",data:e})}},"549b":function(e,t,a){"use strict";var o=a("d864"),n=a("63b6"),r=a("241e"),i=a("b0dc"),s=a("3702"),l=a("b447"),u=a("20fd"),c=a("7cd6");n(n.S+n.F*!a("4ee1")((function(e){Array.from(e)})),"Array",{from:function(e){var t,a,n,d,h=r(e),f="function"==typeof this?this:Array,m=arguments.length,p=m>1?arguments[1]:void 0,b=void 0!==p,g=0,D=c(h);if(b&&(p=o(p,m>2?arguments[2]:void 0,2)),void 0==D||f==Array&&s(D))for(t=l(h.length),a=new f(t);t>g;g++)u(a,g,b?p(h[g],g):h[g]);else for(d=D.call(h),a=new f;!(n=d.next()).done;g++)u(a,g,b?i(d,p,[n.value,g],!0):n.value);return a.length=g,a}})},"54a1":function(e,t,a){a("6c1c"),a("1654"),e.exports=a("95d5")},"75fc":function(e,t,a){"use strict";var o=a("a745"),n=a.n(o);function r(e){if(n()(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}var i=a("774e"),s=a.n(i),l=a("c8bb"),u=a.n(l);function c(e){if(u()(Object(e))||"[object Arguments]"===Object.prototype.toString.call(e))return s()(e)}function d(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function h(e){return r(e)||c(e)||d()}a.d(t,"a",(function(){return h}))},"774e":function(e,t,a){e.exports=a("d2d5")},"95d5":function(e,t,a){var o=a("40c3"),n=a("5168")("iterator"),r=a("481b");e.exports=a("584a").isIterable=function(e){var t=Object(e);return void 0!==t[n]||"@@iterator"in t||r.hasOwnProperty(o(t))}},a745:function(e,t,a){e.exports=a("f410")},aa1f:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-cascader",{attrs:{placeholder:e.placeholder,options:e.list,clearable:"",props:{checkStrictly:!0,value:"id",label:"w_name",children:"children"}},on:{change:e.change},model:{value:e.choosesValue,callback:function(t){e.choosesValue=t},expression:"choosesValue"}})},n=[],r=(a("55dd"),a("75fc")),i=a("4ff7"),s={name:"index",props:{placeholder:{type:String,default:"请选择仓库"},value:null},data:function(){return{choosesValue:[],list:[]}},methods:{change:function(){this.$emit("input",this.choosesValue[this.choosesValue.length-1])}},watch:{value:{immediate:!0,handler:function(e){if(e){var t=function e(t,o,n){n.some((function(n){var i=n.children||[];if(n.id===o)return a=t,!0;if(i.length>0){var s=Object(r["a"])(t);return s.push(n.id),e(s,o,i)}}))},a=[];t([],e,this.list),this.choosesValue=[e].concat(Object(r["a"])(a)).sort()}else this.choosesValue=[]}}},beforeCreate:function(){var e=this;Object(i["e"])().then((function(t){200===t.code&&(e.list=t.data)})).catch((function(e){console.log(e)}))}},l=s,u=(a("1e31"),a("2877")),c=Object(u["a"])(l,o,n,!1,null,"1fa4dcec",null);t["default"]=c.exports},ab06:function(e,t,a){},c680:function(e,t,a){"use strict";var o=a("ab06"),n=a.n(o);n.a},c8bb:function(e,t,a){e.exports=a("54a1")},d2d5:function(e,t,a){a("1654"),a("549b"),e.exports=a("584a").Array.from},f410:function(e,t,a){a("1af6"),e.exports=a("584a").Array.isArray}}]);