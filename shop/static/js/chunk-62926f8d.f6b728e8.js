(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-62926f8d","chunk-2d43a88e"],{"01d1":function(t,e,a){"use strict";a.d(e,"d",(function(){return i})),a.d(e,"e",(function(){return o})),a.d(e,"a",(function(){return l})),a.d(e,"b",(function(){return r})),a.d(e,"c",(function(){return s}));var n=a("b775"),i=function(t){return Object(n["a"])({url:"/warehouse/supplier_manage/getList",method:"post",data:t})},o=function(t){return Object(n["a"])({url:"/system/common/getSupplier",method:"post",data:t})},l=function(t){return Object(n["a"])({url:"/warehouse/supplier_manage/add",method:"post",data:t})},r=function(t){return Object(n["a"])({url:"/warehouse/supplier_manage/del",method:"post",data:t})},s=function(t){return Object(n["a"])({url:"/warehouse/supplier_manage/edit",method:"post",data:t})}},3738:function(t,e,a){"use strict";var n=a("6c23"),i=a.n(n);i.a},"57f5":function(t,e,a){"use strict";a.d(e,"a",(function(){return i})),a.d(e,"b",(function(){return o}));var n=a("b775"),i=function(t){return Object(n["a"])({url:"/purchase/Purchase_record/getList",method:"post",data:t})},o=function(t){return Object(n["a"])({url:"/purchase/Purchase_record/purCancel",method:"post",data:t})}},"65f6":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"upload-info"},[a("div",[a("el-upload",{staticClass:"upload-pic",attrs:{"list-type":"picture-card",action:t.domain,data:t.QiniuData,"on-remove":t.handleRemove,"on-success":t.uploadSuccess,"before-upload":t.beforeAvatarUpload,multiple:!1,"file-list":t.fileList}},[a("i",{staticClass:"el-icon-plus"})])],1)])},i=[],o=(a("7f7f"),a("b26e")),l={data:function(){return{loading:!0,QiniuData:{key:"",token:""},domain:"https://upload-z2.qiniup.com",qiniuaddr:"",fileList:[]}},mounted:function(){this.getQiniuToken()},methods:{handleRemove:function(t,e){var a=this,n=[];e.map((function(t){n.push("".concat(a.qiniuaddr).concat(t.response.key))})),this.$emit("getImgUrls",n)},beforeAvatarUpload:function(t){var e="image/png"===t.type,a="image/jpeg"===t.type,n="image/jpg"===t.type,i=t.size/1024/1024<2;return e||a||n?i?void(this.QiniuData.key=(new Date).getTime()+"_upload_"+Math.floor(100*Math.random())+"_"+t.name):(this.$message.error("上传头像图片大小不能超过 2MB!"),!1):(this.$message.error("上传头像图片只能是 jpg、png、jpeg 格式!"),!1)},uploadSuccess:function(t,e,a){var n=this;console.log(t,e,a);var i=[];a.map((function(t){i.push("".concat(n.qiniuaddr).concat(t.response.key))})),this.$emit("getImgUrls",i)},getQiniuToken:function(){var t=this;Object(o["g"])().then((function(e){200===e.code&&(t.QiniuData.token=e.data.token,t.qiniuaddr=e.data.domain)})).catch((function(t){}))}}},r=l,s=a("2877"),u=Object(s["a"])(r,n,i,!1,null,null,null);e["default"]=u.exports},"6c23":function(t,e,a){},b26e:function(t,e,a){"use strict";a.d(e,"f",(function(){return i})),a.d(e,"g",(function(){return o})),a.d(e,"e",(function(){return l})),a.d(e,"a",(function(){return r})),a.d(e,"b",(function(){return s})),a.d(e,"c",(function(){return u})),a.d(e,"i",(function(){return d})),a.d(e,"h",(function(){return c})),a.d(e,"d",(function(){return p}));var n=a("b775"),i=function(t){return Object(n["a"])({url:"/system/common/getAllGoods",method:"get",params:t})},o=function(t){return Object(n["a"])({url:"/system/Common/getQiNiuToken",method:"get",params:t})},l=function(t){return Object(n["a"])({url:"/goods/goods_brand/getList",method:"post",params:t})},r=function(t){return Object(n["a"])({url:"/goods/goods_brand/add",method:"post",params:t})},s=function(t){return Object(n["a"])({url:"/goods/goods_brand/del",method:"post",params:t})},u=function(t){return Object(n["a"])({url:"/goods/goods_brand/edit",method:"post",params:t})},d=function(t){return Object(n["a"])({url:"/goods/goods_resource/getList",method:"post",params:t})},c=function(t){return Object(n["a"])({url:"/goods/goods_resource/del",method:"post",params:t})},p=function(t){return Object(n["a"])({url:"/system/common/findChilds",method:"post",params:t})}},b775:function(t,e,a){"use strict";var n,i=a("bc3a"),o=a.n(i),l=a("5c96"),r=a("4360"),s=o.a.create({baseURL:"http://ddxm661.com:8088",timeout:5e3});s.interceptors.request.use((function(t){return n=l["Loading"].service({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),t}),(function(t){return console.log(t),Promise.reject()})),s.interceptors.response.use((function(t){if(n.close(),200===t.status)return-1==t.data.code&&(r["a"].commit("setUserInfo",{}),window.localStorage.removeItem("router"),window.location.href="#/login",setTimeout((function(){window.location.reload()}),150)),200!=t.data.code&&(l["Message"].closeAll(),Object(l["Message"])({message:t.data.msg,type:"error"})),t.data;Promise.reject()}),(function(t){return n.close(),console.log(t),Promise.reject()})),e["a"]=s},c1ec:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"crumbs"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[t._v("来往款项")])],1)],1),a("div",{staticClass:"container"},[a("div",{staticClass:"search-div"},[a("el-select",{staticClass:"my-input",attrs:{placeholder:"请选择供应商",clearable:""},model:{value:t.requestData.seach_val,callback:function(e){t.$set(t.requestData,"seach_val",e)},expression:"requestData.seach_val"}},t._l(t.addDialog.supplier,(function(t,e){return a("el-option",{key:e,attrs:{label:t.s_name,value:t.id}})})),1),a("el-button",{attrs:{type:"primary"},on:{click:t.getList}},[t._v("查询")]),t.$_has("add")?a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(e){t.addDialog.isShow=!0}}},[t._v("新增")]):t._e()],1),a("div",{staticStyle:{margin:"40px 0"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.responseData.data}},[a("el-table-column",{attrs:{type:"index",label:"序号"}}),a("el-table-column",{attrs:{prop:"s_name",label:"供应商"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("p",[t._v("姓名： "+t._s(e.row.s_name))]),a("p",[t._v("手机号： "+t._s(e.row.s_phone))])]}}])}),a("el-table-column",{attrs:{prop:"amount",label:"金额"}}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.$_has("find")?a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.detailsDialogShow(e.row.supplier_id)}}},[t._v("查看明细")]):t._e()]}}])})],1)],1),a("div",[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:t.responseData.total},on:{"current-change":t.handleCurrentChange}})],1)]),a("el-dialog",{attrs:{title:"新增打款",visible:t.addDialog.isShow,width:"50%",center:""},on:{"update:visible":function(e){return t.$set(t.addDialog,"isShow",e)}}},[a("div",{staticStyle:{"margin-bottom":"20px",display:"flex","justify-content":"flex-start","align-items":"center"}},[a("el-select",{staticClass:"my-input",attrs:{placeholder:"请选择供应商"},on:{change:t.supplierChange},model:{value:t.addDialog.table.requestData.sup_id,callback:function(e){t.$set(t.addDialog.table.requestData,"sup_id",e)},expression:"addDialog.table.requestData.sup_id"}},t._l(t.addDialog.supplier,(function(t,e){return a("el-option",{key:e,attrs:{label:t.s_name,value:t.id}})})),1),a("div",{staticStyle:{"margin-left":"20px"}},[a("span",{staticStyle:{"margin-right":"20px"}},[t._v("总采购金额："),a("el-tag",{attrs:{type:"danger"}},[t._v(t._s(t.addDialog.requestData.remittance.r_total_amount))])],1),a("span",{staticStyle:{"margin-right":"20px"}},[t._v("总打款金额："),a("el-tag",{attrs:{type:"danger"}},[t._v(t._s(t.addDialog.requestData.remittance.r_total_remittance))])],1),a("span",{staticStyle:{"margin-right":"20px"}},[t._v("总抵扣金额："),a("el-tag",{attrs:{type:"danger"}},[t._v(t._s(t.addDialog.requestData.remittance.r_deduct_amount))])],1),t.addDialog.r_deduct_amount?a("span",{staticStyle:{"margin-right":"20px"}},[t._v("可抵扣金额："),a("el-tag",{attrs:{type:"danger"}},[t._v(t._s(t.addDialog.r_deduct_amount))])],1):t._e()])],1),a("div",{staticStyle:{"margin-bottom":"20px"}},[a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{"max-height":"250px",data:t.addDialog.table.responseData.data,"row-key":t.getRowKey},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55","reserve-selection":!0}}),a("el-table-column",{attrs:{label:"采购单号",width:"150",prop:"sn"}}),a("el-table-column",{attrs:{label:"商品条形码",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.items,(function(e,n){return a("div",{key:n},[t._v(t._s(e.bar_code))])}))}}])}),a("el-table-column",{attrs:{label:"商品名称",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.items,(function(e,n){return a("div",{key:n},[t._v(t._s(e.title))])}))}}])}),a("el-table-column",{attrs:{label:"商品规格",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.items,(function(e,n){return a("div",{key:n},[t._v(t._s(e.attr_name))])}))}}])}),a("el-table-column",{attrs:{label:"采购单价"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.items,(function(e,n){return a("div",{key:n},[t._v(t._s(e.price))])}))}}])}),a("el-table-column",{attrs:{label:"采购数量"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.items,(function(e,n){return a("div",{key:n},[t._v(t._s(e.num))])}))}}])}),a("el-table-column",{attrs:{label:"邮费",prop:"postage"}}),a("el-table-column",{attrs:{label:"总金额"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.items,(function(e,n){return a("div",{key:n},[t._v(t._s(e.amount))])}))}}])}),a("el-table-column",{attrs:{label:"采购时间",width:"150",prop:"create_time"}}),a("el-table-column",{attrs:{label:"打款金额",width:"100",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{placeholder:"打款金额"},model:{value:e.row.rf_amount,callback:function(a){t.$set(e.row,"rf_amount",a)},expression:"scope.row.rf_amount"}})]}}])}),a("el-table-column",{attrs:{label:"抵扣金额",width:"100",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{placeholder:"抵扣金额"},model:{value:e.row.rf_deduct_amount,callback:function(a){t.$set(e.row,"rf_deduct_amount",a)},expression:"scope.row.rf_deduct_amount"}})]}}])})],1),a("div",{staticStyle:{"text-align":"right","margin-top":"10px"}},[a("el-pagination",{attrs:{total:t.addDialog.table.responseData.count,background:"",layout:"prev, pager, next"},on:{"current-change":t.addDialogGetTableListHandleCurrentChange}})],1)],1),a("div",{staticStyle:{"margin-bottom":"20px",display:"flex","flex-wrap":"wrap","justify-content":"flex-start"}},[a("upload-img",{on:{getImgUrls:t.getUploadImgUrl}}),a("el-input",{staticStyle:{"margin-left":"20px",width:"200px",height:"148px"},attrs:{type:"textarea",placeholder:"备注"},model:{value:t.addDialog.requestData.remittance.desc,callback:function(e){t.$set(t.addDialog.requestData.remittance,"desc",e)},expression:"addDialog.requestData.remittance.desc"}})],1),a("div",[a("el-button",{attrs:{type:"primary"},on:{click:t.addDialogConfirm}},[t._v("新增打款")])],1)]),a("el-dialog",{attrs:{title:"查看明细",visible:t.detailsDialog.isShow,width:"50%",center:""},on:{"update:visible":function(e){return t.$set(t.detailsDialog,"isShow",e)}}},[a("div",{staticStyle:{"margin-bottom":"20px",display:"flex","justify-content":"flex-start","align-items":"center"}},[a("el-select",{staticClass:"my-input",staticStyle:{"margin-right":"10px"},attrs:{placeholder:"请选择供应商"},model:{value:t.detailsDialog.requestData.id,callback:function(e){t.$set(t.detailsDialog.requestData,"id",e)},expression:"detailsDialog.requestData.id"}},t._l(t.addDialog.supplier,(function(t,e){return a("el-option",{key:e,attrs:{label:t.s_name,value:t.id}})})),1),a("el-date-picker",{staticStyle:{"margin-right":"10px"},attrs:{"value-format":"yyyy-MM-dd",type:"datetimerange","range-separator":"至","start-placeholder":"打款时间开始","end-placeholder":"打款时间结束"},on:{change:t.detailsDialogChangeRequestTime},model:{value:t.detailsDialog.requestData.time,callback:function(e){t.$set(t.detailsDialog.requestData,"time",e)},expression:"detailsDialog.requestData.time"}}),a("el-button",{attrs:{type:"primary"},on:{click:t.detailsDialogGetList}},[t._v("搜索")])],1),a("div",{staticStyle:{"margin-bottom":"20px"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{"max-height":"250px",data:t.detailsDialog.responseData.data}},[a("el-table-column",{attrs:{label:"序号",type:"index"}}),a("el-table-column",{attrs:{label:"采购金额",prop:"purchase_amount"}}),a("el-table-column",{attrs:{label:"打款金额",prop:"rf_amount"}}),a("el-table-column",{attrs:{label:"抵扣金额",prop:"rf_deduct_amount"}}),a("el-table-column",{attrs:{label:"打款时间",width:"150",prop:"create_time"}}),a("el-table-column",{attrs:{label:"备注",width:"150",prop:"desc"}}),a("el-table-column",{attrs:{label:"打款人",prop:"a_username"}}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.$_has("removeRemittance")?a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.detailsDialogCancel(e.row.id,e.row.purchase_id)}}},[t._v("取消打款")]):t._e()]}}])})],1),a("div",{staticStyle:{"text-align":"right","margin-top":"10px"}},[a("el-pagination",{attrs:{total:t.detailsDialog.responseData.total,background:"",layout:"prev, pager, next"},on:{"current-change":t.detailsDialogHandleCurrentChange}})],1)],1)])],1)},i=[],o=(a("ac4d"),a("8a81"),a("ac6a"),a("b775")),l=function(t){return Object(o["a"])({url:"/finance/remittance_flow/getList",method:"post",data:t})},r=function(t){return Object(o["a"])({url:"/finance/remittance_flow/add",method:"post",data:t})},s=function(t){return Object(o["a"])({url:"/finance/remittance_flow/find",method:"post",data:t})},u=function(t){return Object(o["a"])({url:"/finance/remittance_flow/removeRemittance",method:"post",data:t})},d=a("57f5"),c=a("01d1"),p=a("65f6"),m={name:"index",data:function(){return{responseData:{total:0,per_page:10,current_page:1,last_page:1,data:[]},requestData:{page:1,limit:10,seach_val:""},addDialog:{isShow:!1,supplier:[],r_deduct_amount:"",table:{requestData:{sup_id:"",page:1,limit:10},responseData:{count:0,data:[]},multipleSelectionAll:[]},requestData:{remittance:{r_total_amount:0,r_total_remittance:0,r_deduct_amount:0,r_voucher_img:"",supplier_id:0,desc:""},remittance_flow:[]}},detailsDialog:{isShow:!1,requestData:{id:"",time:"",start_time:"",end_time:"",page:1},responseData:{total:0,data:[]}}}},methods:{getList:function(){var t=this;l(this.requestData).then((function(e){200===e.code&&(t.responseData=e.data)}))},handleCurrentChange:function(t){this.requestData.page=t,this.getList()},addDialogGetTableList:function(){var t=this;Object(d["a"])(this.addDialog.table.requestData).then((function(e){200===e.code&&(e.data.data.forEach((function(a,n){e.data.data[n].rf_amount="",parseFloat(t.addDialog.r_deduct_amount)<=0?e.data.data[n].rf_deduct_amount="0":e.data.data[n].rf_deduct_amount="",t.addDialog.table.multipleSelectionAll.forEach((function(a,i){e.data.data[n].id==t.addDialog.table.multipleSelectionAll[i].id&&t.$refs.multipleTable.toggleRowSelection(e.data.data[n],!0)}))})),t.addDialog.table.responseData=e.data)})).catch((function(t){console.log(t)}))},addDialogGetTableListHandleCurrentChange:function(t){this.addDialog.table.requestData.page=t,this.addDialogGetTableList()},getUploadImgUrl:function(t){this.addDialog.requestData.remittance.r_voucher_img=t.join(",")},handleSelectionChange:function(t){this.addDialog.table.multipleSelectionAll=t},getRowKey:function(t){return t.id},supplierChange:function(t){var e=this;this.addDialog.table.requestData.page=1,this.addDialog.table.multipleSelectionAll=[],this.$refs.multipleTable.clearSelection(),this.addDialogGetTableList(),this.addDialog.supplier.map((function(a){a.id==t&&(e.addDialog.r_deduct_amount=a.s_balance)}))},addDialogConfirm:function(){var t=this;if(this.addDialog.requestData.remittance.supplier_id=this.addDialog.table.requestData.sup_id,this.addDialog.table.multipleSelectionAll.length)if(parseFloat(this.addDialog.r_deduct_amount)<parseFloat(this.addDialog.requestData.remittance.r_deduct_amount))this.$message.error("新增的打款单总折扣金额大于可用的折扣金额");else{var e=[],a=!1,n=!0,i=!1,o=void 0;try{for(var l,s=this.addDialog.table.multipleSelectionAll[Symbol.iterator]();!(n=(l=s.next()).done);n=!0){var u=l.value;if(!u.rf_amount||parseFloat(u.rf_amount)<0){a=!0,this.$message.error("请正确输入【".concat(u.sn,"】采购单的打款金额"));break}if(!u.rf_deduct_amount||parseFloat(u.rf_deduct_amount)<0){a=!0,this.$message.error("请正确输入【".concat(u.sn,"】采购单的折扣金额"));break}e.push({purchase_id:u.id,purchase_amount:u.items.reduce((function(t,e){return t+parseFloat(e.amount)}),0),rf_amount:parseFloat(u.rf_amount),rf_deduct_amount:parseFloat(u.rf_deduct_amount),supplier_id:this.addDialog.table.requestData.sup_id})}}catch(d){i=!0,o=d}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}e.length!==this.addDialog.table.multipleSelectionAll.length&&(a=!0),a||(this.addDialog.requestData.remittance_flow=e,this.$confirm("您确定新增打款吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){r(t.addDialog.requestData).then((function(e){200===e.code&&(t.addDialog.isShow=!1,t.getList(),t.$message({type:"success",message:"新增成功!"}),t.addDialog.requestData={remittance:{r_total_amount:0,r_total_remittance:0,r_deduct_amount:0,r_voucher_img:"",supplier_id:0,desc:""},remittance_flow:[]})})).catch((function(e){console.log(e),t.$message.error("操作失败")}))})).catch((function(e){t.$message({type:"info",message:"已取消操作"})})))}else this.$message.error("请选择采购单并输入打款和折扣金额")},detailsDialogShow:function(t){this.detailsDialog.requestData.id=t,this.detailsDialog.isShow=!0,this.detailsDialog.requestData.page=1,this.detailsDialogGetList()},detailsDialogChangeRequestTime:function(t){this.detailsDialog.requestData.start_time=t[0],this.detailsDialog.requestData.end_time=t[1]},detailsDialogHandleCurrentChange:function(t){this.detailsDialog.requestData.page=t,this.detailsDialogGetList()},detailsDialogGetList:function(){var t=this;s(this.detailsDialog.requestData).then((function(e){200===e.code&&(t.detailsDialog.responseData=e.data)})).catch((function(t){console.log(t)}))},detailsDialogCancel:function(t,e){var a=this;this.$confirm("本次操作将取消打款, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){u({id:t,purchase_id:e}).then((function(t){200===t.code&&a.detailsDialogGetList()})).catch((function(t){console.log(t)}))})).catch((function(){a.$message({type:"info",message:"已取消取消打款操作"})}))}},created:function(){var t=this;this.getList(),Object(c["e"])().then((function(e){200===e.code&&(t.addDialog.supplier=e.data)}))},watch:{"addDialog.table.multipleSelectionAll":{deep:!0,handler:function(t,e){var a=0,n=0,i=0;t.map((function(t){t.items.map((function(t){a+=parseFloat(t.amount)})),n+=parseFloat(t.rf_amount),i+=parseFloat(t.rf_deduct_amount)})),this.addDialog.requestData.remittance.r_total_amount=a||0,this.addDialog.requestData.remittance.r_total_remittance=n||0,this.addDialog.requestData.remittance.r_deduct_amount=i||0}}},components:{uploadImg:p["default"]}},g=m,f=(a("3738"),a("2877")),h=Object(f["a"])(g,n,i,!1,null,"fc615abc",null);e["default"]=h.exports}}]);