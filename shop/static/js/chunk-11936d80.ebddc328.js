(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-11936d80"],{"00d6":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"crumbs"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[t._v("调拨单")])],1)],1),a("div",{staticClass:"container"},[a("div",{staticClass:"search-div"},[a("el-select",{staticClass:"my-input",attrs:{placeholder:"调拨单状态",clearable:""},model:{value:t.requestData.status,callback:function(e){t.$set(t.requestData,"status",e)},expression:"requestData.status"}},[a("el-option",{attrs:{label:"待发货",value:"1"}}),a("el-option",{attrs:{label:"调拨中(已发货)",value:"2"}}),a("el-option",{attrs:{label:"已完成",value:"3"}})],1),a("el-input",{staticClass:"my-input",staticStyle:{width:"250px"},attrs:{clearable:"",placeholder:"调拨单号"},model:{value:t.requestData.a_sn,callback:function(e){t.$set(t.requestData,"a_sn",e)},expression:"requestData.a_sn"}}),a("depot",{staticClass:"my-input",attrs:{placeholder:"调入仓库"},model:{value:t.requestData.warehouse_id_in,callback:function(e){t.$set(t.requestData,"warehouse_id_in",e)},expression:"requestData.warehouse_id_in"}}),a("depot",{staticClass:"my-input",attrs:{placeholder:"调出仓库"},model:{value:t.requestData.warehouse_id_out,callback:function(e){t.$set(t.requestData,"warehouse_id_out",e)},expression:"requestData.warehouse_id_out"}})],1),a("div",[a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.requestData.page=1,t.getList()}}},[t._v("搜索")]),a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(e){t.addDialog.isShow=!0}}},[t._v("新增调拨单")])],1),a("div",{staticStyle:{margin:"40px 0"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.responseData.data,border:""}},[a("el-table-column",{attrs:{label:"序号",type:"index"}}),a("el-table-column",{attrs:{label:"调拨单号",prop:"a_sn"}}),a("el-table-column",{attrs:{label:"调出仓库",prop:"warehouse_out_name"}}),a("el-table-column",{attrs:{label:"调入仓库",prop:"warehouse_in_name"}}),a("el-table-column",{attrs:{label:"操作人",prop:"create_name"}}),a("el-table-column",{attrs:{label:"备注",prop:"remarks"}}),a("el-table-column",{attrs:{label:"入库时间",prop:"warehousing_time"}}),a("el-table-column",{attrs:{label:"状态",prop:"status_name"}}),a("el-table-column",{attrs:{label:"商品名称",width:"250"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.items,(function(e,o){return a("div",{key:o},[t._v(t._s(e.title))])}))}}])}),a("el-table-column",{attrs:{label:"商品条形码",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.items,(function(e,o){return a("div",{key:o},[t._v(t._s(e.bar_code))])}))}}])}),a("el-table-column",{attrs:{label:"商品规格"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.items,(function(e,o){return a("div",{key:o},[t._v(t._s(e.attr_name))])}))}}])}),a("el-table-column",{attrs:{label:"调拨数量"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.items,(function(e,o){return a("div",{key:o},[t._v(t._s(e.num))])}))}}])}),a("el-table-column",{attrs:{label:"操作",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[1===e.row.status?a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.editDialogShow(e.row)}}},[t._v("编辑")]):t._e(),2===e.row.status?a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.allotConfirm(e.row.id)}}},[t._v("确认入库")]):t._e(),1===e.row.status?a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.allotSendGoods(e.row.id)}}},[t._v("调拨单发货")]):t._e(),2===e.row.status?a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.allotSendGoodsCancel(e.row.id)}}},[t._v("调拨单取消发货")]):t._e()]}}])})],1)],1),a("div",[a("el-pagination",{attrs:{total:t.responseData.count,background:"",layout:"prev, pager, next"},on:{"current-change":t.handleCurrentChange}})],1)]),a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],staticClass:"send-goods-dialog",attrs:{title:"新增调拨单",center:"",visible:t.addDialog.isShow,width:"50%"},on:{"update:visible":function(e){return t.$set(t.addDialog,"isShow",e)}}},[a("el-button",{staticStyle:{"margin-bottom":"10px"},attrs:{type:"primary"},on:{click:t.addDialogGetChoosesGoodsDialogShow}},[t._v("选择商品")]),a("div",{staticClass:"search-div"},[a("depot",{staticClass:"my-input",attrs:{placeholder:"调出仓库"},model:{value:t.addDialog.requestData.warehouse_id_out,callback:function(e){t.$set(t.addDialog.requestData,"warehouse_id_out",e)},expression:"addDialog.requestData.warehouse_id_out"}}),a("depot",{staticClass:"my-input",attrs:{placeholder:"调入仓库"},model:{value:t.addDialog.requestData.warehouse_id_in,callback:function(e){t.$set(t.addDialog.requestData,"warehouse_id_in",e)},expression:"addDialog.requestData.warehouse_id_in"}}),a("el-input",{staticClass:"my-input",attrs:{placeholder:"调拨单备注，选填"},model:{value:t.addDialog.requestData.remarks,callback:function(e){t.$set(t.addDialog.requestData,"remarks",e)},expression:"addDialog.requestData.remarks"}})],1),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.addDialog.requestData.items,border:"","max-height":"400"}},[a("el-table-column",{attrs:{type:"index",label:"序号"}}),a("el-table-column",{attrs:{prop:"title",label:"商品名称"}}),a("el-table-column",{attrs:{prop:"bar_code",label:"条形码"}}),a("el-table-column",{attrs:{prop:"attr_name",label:"规格"}}),a("el-table-column",{attrs:{label:"图片"},scopedSlots:t._u([{key:"default",fn:function(t){return[a("el-image",{staticClass:"table-td-thumb",staticStyle:{width:"50px",height:"50px",margin:"10px"},attrs:{src:t.row.pic,"preview-src-list":[t.row.pic]}})]}}])}),a("el-table-column",{attrs:{prop:"kuchun",label:"库存"}}),a("el-table-column",{attrs:{label:"调拨数量"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{model:{value:e.row.num,callback:function(a){t.$set(e.row,"num",a)},expression:"scope.row.num"}})]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.addDialog.requestData.items.splice(e.$index,1)}}},[t._v("删除")])]}}])})],1),a("div",{staticStyle:{"margin-top":"50px","text-align":"center"}},[a("el-button",{attrs:{type:"primary"},on:{click:t.addDialogSubmit}},[t._v("提交")])],1)],1),a("choosesGoods",{attrs:{visible:t.addDialog.choosesGoodsDialog.isShow,requestData:{warehouse_id:t.addDialog.requestData.warehouse_id_out}},on:{"update:visible":function(e){return t.$set(t.addDialog.choosesGoodsDialog,"isShow",e)},sendChoosesGoods:t.addDialogGetChoosesGoods}}),a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],staticClass:"send-goods-dialog",attrs:{title:"编辑调拨单",center:"",visible:t.editDialog.isShow,width:"50%"},on:{"update:visible":function(e){return t.$set(t.editDialog,"isShow",e)}}},[a("el-button",{staticStyle:{"margin-bottom":"10px"},attrs:{type:"primary"},on:{click:function(e){t.editDialog.choosesGoodsDialog.isShow=!0}}},[t._v("选择商品")]),a("el-form",{attrs:{"label-width":"80px",inline:!0}},[a("el-form-item",{attrs:{label:"调出仓库"}},[a("el-input",{staticClass:"my-input",attrs:{disabled:"",value:t.editDialog.responseData.warehouse_out_name,placeholder:"调出仓库"}})],1),a("el-form-item",{attrs:{label:"调入仓库"}},[a("el-input",{staticClass:"my-input",attrs:{disabled:"",value:t.editDialog.responseData.warehouse_in_name,placeholder:"调入仓库"}})],1),a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{staticClass:"my-input",attrs:{placeholder:""},model:{value:t.addDialog.requestData.remarks,callback:function(e){t.$set(t.addDialog.requestData,"remarks",e)},expression:"addDialog.requestData.remarks"}})],1)],1),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.editDialog.requestData.items,border:"","max-height":"400"}},[a("el-table-column",{attrs:{type:"index",label:"序号"}}),a("el-table-column",{attrs:{prop:"title",label:"商品名称"}}),a("el-table-column",{attrs:{prop:"bar_code",label:"条形码"}}),a("el-table-column",{attrs:{prop:"attr_name",label:"规格"}}),a("el-table-column",{attrs:{label:"图片"},scopedSlots:t._u([{key:"default",fn:function(t){return[a("el-image",{staticClass:"table-td-thumb",staticStyle:{width:"50px",height:"50px",margin:"10px"},attrs:{src:t.row.pic,"preview-src-list":[t.row.pic]}})]}}])}),a("el-table-column",{attrs:{prop:"kuchun",label:"库存"}}),a("el-table-column",{attrs:{label:"调拨数量"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{model:{value:e.row.num,callback:function(a){t.$set(e.row,"num",a)},expression:"scope.row.num"}})]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.editDialog.requestData.items.splice(e.$index,1)}}},[t._v("删除")])]}}])})],1),a("div",{staticStyle:{"margin-top":"50px","text-align":"center"}},[a("el-button",{attrs:{type:"primary"},on:{click:t.editDialogSubmit}},[t._v("提交")])],1)],1),a("choosesGoods",{attrs:{visible:t.editDialog.choosesGoodsDialog.isShow,requestData:{warehouse_id:t.editDialog.requestData.warehouse_id_out}},on:{"update:visible":function(e){return t.$set(t.editDialog.choosesGoodsDialog,"isShow",e)},sendChoosesGoods:t.editDialogGetChoosesGoods}})],1)},i=[],s=(a("ac4d"),a("8a81"),a("ac6a"),a("75fc")),r=a("b775"),n=function(t){return Object(r["a"])({url:"/warehouse/Allot/getList",method:"post",data:t})},l=function(t){return Object(r["a"])({url:"/warehouse/Allot/add",method:"post",data:t})},u=function(t){return Object(r["a"])({url:"/warehouse/Allot/confirm",method:"post",data:t})},c=function(t){return Object(r["a"])({url:"/warehouse/Allot/sendGoods",method:"post",data:t})},d=function(t){return Object(r["a"])({url:"/warehouse/Allot/cancelSendGoods",method:"post",data:t})},h=function(t){return Object(r["a"])({url:"/warehouse/Allot/edit",method:"post",data:t})},m=a("aa1f"),f=a("89ed"),p={name:"index",data:function(){return{requestData:{a_sn:"",status:"",warehouse_id_in:"",warehouse_id_out:"",page:1,limit:10},responseData:{count:0,data:[]},addDialog:{isShow:!1,requestData:{warehouse_id_in:0,warehouse_id_out:0,remarks:"",items:[]},choosesGoodsDialog:{isShow:!1}},editDialog:{isShow:!1,requestData:{id:0,warehouse_id_in:0,warehouse_id_out:0,remarks:"",items:[]},responseData:{warehouse_in_name:"",warehouse_out_name:""},choosesGoodsDialog:{isShow:!1}}}},methods:{getList:function(){var t=this;n(this.requestData).then((function(e){200===e.code&&(t.responseData=e.data)})).catch((function(t){console.log(t)}))},handleCurrentChange:function(t){this.requestData.page=t,this.getList()},addDialogGetChoosesGoodsDialogShow:function(){this.addDialog.requestData.warehouse_id_out?this.addDialog.choosesGoodsDialog.isShow=!0:this.$message.error("请选择调出仓库后再选商品")},addDialogGetChoosesGoods:function(t){var e=[],a=[],o=!0,i=!1,r=void 0;try{for(var n,l=t[Symbol.iterator]();!(o=(n=l.next()).done);o=!0){var u=n.value;parseInt(u.w_stock)>0&&e.push({item_id:u.id,title:u.g_title,pic:u.imgurl,attr_ids:u.key,attr_name:u.key_name,bar_code:u.code,kuchun:u.w_stock,num:""})}}catch(d){i=!0,r=d}finally{try{o||null==l.return||l.return()}finally{if(i)throw r}}a=[].concat(Object(s["a"])(this.addDialog.requestData.items),e);var c={};this.addDialog.requestData.items=a.reduce((function(t,e){return!c[e.item_id+e.attr_ids]&&(c[e.item_id+e.attr_ids]=t.push(e)),t}),[])},addDialogSubmit:function(){var t=this,e=!1;if(this.addDialog.requestData.warehouse_id_out)if(this.addDialog.requestData.warehouse_id_in)if(0!==this.addDialog.requestData.items.length){var a=!0,o=!1,i=void 0;try{for(var s,r=this.addDialog.requestData.items[Symbol.iterator]();!(a=(s=r.next()).done);a=!0){var n=s.value;if(parseInt(n.num)<=0||parseInt(n.num)>parseInt(n.kuchun)){this.$message.error("【".concat(n.title,"】的调拨数量有误！")),e=!0;break}}}catch(u){o=!0,i=u}finally{try{a||null==r.return||r.return()}finally{if(o)throw i}}e||l(this.addDialog.requestData).then((function(e){200===e.code&&(t.addDialog.isShow=!1,t.requestData.page=1,t.getList(),t.$message.success("新增调拨单成功"))})).catch((function(t){console.log(t)}))}else this.$message.error("请选择商品");else this.$message.error("请选择调入仓库");else this.$message.error("请选择调出仓库")},editDialogShow:function(t){var e=[],a=!0,o=!1,i=void 0;try{for(var s,r=t.items[Symbol.iterator]();!(a=(s=r.next()).done);a=!0){var n=s.value;e.push({item_id:n.item_id,title:n.title,pic:n.pic,attr_ids:n.attr_ids,attr_name:n.attr_name,bar_code:n.bar_code,kuchun:n.num,num:n.num})}}catch(l){o=!0,i=l}finally{try{a||null==r.return||r.return()}finally{if(o)throw i}}this.editDialog.responseData={warehouse_in_name:t.warehouse_in_name,warehouse_out_name:t.warehouse_out_name},this.editDialog.requestData={id:t.id,warehouse_id_in:t.warehouse_id_in,warehouse_id_out:t.warehouse_id_out,remarks:t.remarks,items:e},this.editDialog.isShow=!0},editDialogGetChoosesGoods:function(t){var e=[],a=[],o=!0,i=!1,r=void 0;try{for(var n,l=t[Symbol.iterator]();!(o=(n=l.next()).done);o=!0){var u=n.value;parseInt(u.w_stock)>0&&e.push({item_id:u.id,title:u.g_title,pic:u.imgurl,attr_ids:u.key,attr_name:u.key_name,bar_code:u.code,kuchun:u.w_stock,num:""})}}catch(d){i=!0,r=d}finally{try{o||null==l.return||l.return()}finally{if(i)throw r}}a=[].concat(Object(s["a"])(this.editDialog.requestData.items),e);var c={};this.editDialog.requestData.items=a.reduce((function(t,e){return!c[e.item_id+e.attr_ids]&&(c[e.item_id+e.attr_ids]=t.push(e)),t}),[])},editDialogSubmit:function(){var t=this,e=!1;if(0!==this.editDialog.requestData.items.length){var a=!0,o=!1,i=void 0;try{for(var s,r=this.editDialog.requestData.items[Symbol.iterator]();!(a=(s=r.next()).done);a=!0){var n=s.value;if(parseInt(n.num)<=0||parseInt(n.num)>parseInt(n.kuchun)){this.$message.error("【".concat(n.title,"】的调拨数量有误！")),e=!0;break}}}catch(l){o=!0,i=l}finally{try{a||null==r.return||r.return()}finally{if(o)throw i}}e||h(this.editDialog.requestData).then((function(e){200===e.code&&(t.editDialog.isShow=!1,t.getList(),t.$message.success("编辑调拨单成功"))})).catch((function(t){console.log(t)}))}else this.$message.error("请选择商品")},allotConfirm:function(t){var e=this;this.$confirm("调拨单确认入库, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){u({id:t}).then((function(t){200===t.code&&e.getList()})).catch((function(t){console.log(t)}))})).catch((function(){e.$message({type:"info",message:"已取消确认入库"})}))},allotSendGoods:function(t){var e=this;this.$confirm("调拨单发货, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){c({id:t}).then((function(t){200===t.code&&e.getList()})).catch((function(t){console.log(t)}))})).catch((function(){e.$message({type:"info",message:"已取消确认入库"})}))},allotSendGoodsCancel:function(t){var e=this;this.$confirm("调拨单取消发货, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){d({id:t}).then((function(t){200===t.code&&e.getList()})).catch((function(t){console.log(t)}))})).catch((function(){e.$message({type:"info",message:"已取消确认入库"})}))}},beforeMount:function(){this.getList()},components:{depot:m["default"],choosesGoods:f["default"]},watch:{"addDialog.requestData.warehouse_id_out":function(t,e){this.addDialog.requestData.items=[]},"addDialog.isShow":function(t,e){t||(this.addDialog.requestData={warehouse_id_in:0,warehouse_id_out:0,remarks:"",items:[]})}}},b=p,g=(a("7ba3"),a("2877")),_=Object(g["a"])(b,o,i,!1,null,"2cddf792",null);e["default"]=_.exports},"0e43":function(t,e,a){},"1af6":function(t,e,a){var o=a("63b6");o(o.S,"Array",{isArray:a("9003")})},"1e31":function(t,e,a){"use strict";var o=a("0e43"),i=a.n(o);i.a},"20fd":function(t,e,a){"use strict";var o=a("d9f6"),i=a("aebd");t.exports=function(t,e,a){e in t?o.f(t,e,i(0,a)):t[e]=a}},"3dcb":function(t,e,a){},"4ff7":function(t,e,a){"use strict";a.d(e,"d",(function(){return i})),a.d(e,"e",(function(){return s})),a.d(e,"a",(function(){return r})),a.d(e,"b",(function(){return n})),a.d(e,"c",(function(){return l}));var o=a("b775"),i=function(t){return Object(o["a"])({url:"/warehouse/warehouse_manage/getList",method:"post",data:t})},s=function(t){return Object(o["a"])({url:"/system/common/getWarehouse",method:"post",data:t})},r=function(t){return Object(o["a"])({url:"/warehouse/warehouse_manage/add",method:"post",data:t})},n=function(t){return Object(o["a"])({url:"/warehouse/warehouse_manage/del",method:"post",data:t})},l=function(t){return Object(o["a"])({url:"/warehouse/warehouse_manage/edit",method:"post",data:t})}},"549b":function(t,e,a){"use strict";var o=a("d864"),i=a("63b6"),s=a("241e"),r=a("b0dc"),n=a("3702"),l=a("b447"),u=a("20fd"),c=a("7cd6");i(i.S+i.F*!a("4ee1")((function(t){Array.from(t)})),"Array",{from:function(t){var e,a,i,d,h=s(t),m="function"==typeof this?this:Array,f=arguments.length,p=f>1?arguments[1]:void 0,b=void 0!==p,g=0,_=c(h);if(b&&(p=o(p,f>2?arguments[2]:void 0,2)),void 0==_||m==Array&&n(_))for(e=l(h.length),a=new m(e);e>g;g++)u(a,g,b?p(h[g],g):h[g]);else for(d=_.call(h),a=new m;!(i=d.next()).done;g++)u(a,g,b?r(d,p,[i.value,g],!0):i.value);return a.length=g,a}})},"54a1":function(t,e,a){a("6c1c"),a("1654"),t.exports=a("95d5")},"75fc":function(t,e,a){"use strict";var o=a("a745"),i=a.n(o);function s(t){if(i()(t)){for(var e=0,a=new Array(t.length);e<t.length;e++)a[e]=t[e];return a}}var r=a("774e"),n=a.n(r),l=a("c8bb"),u=a.n(l);function c(t){if(u()(Object(t))||"[object Arguments]"===Object.prototype.toString.call(t))return n()(t)}function d(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function h(t){return s(t)||c(t)||d()}a.d(e,"a",(function(){return h}))},"774e":function(t,e,a){t.exports=a("d2d5")},"7ba3":function(t,e,a){"use strict";var o=a("3dcb"),i=a.n(o);i.a},"95d5":function(t,e,a){var o=a("40c3"),i=a("5168")("iterator"),s=a("481b");t.exports=a("584a").isIterable=function(t){var e=Object(t);return void 0!==e[i]||"@@iterator"in e||s.hasOwnProperty(o(e))}},a745:function(t,e,a){t.exports=a("f410")},aa1f:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-cascader",{attrs:{placeholder:t.placeholder,options:t.list,clearable:"",props:{checkStrictly:!0,value:"id",label:"w_name",children:"children"}},on:{change:t.change},model:{value:t.choosesValue,callback:function(e){t.choosesValue=e},expression:"choosesValue"}})},i=[],s=(a("55dd"),a("75fc")),r=a("4ff7"),n={name:"index",props:{placeholder:{type:String,default:"请选择仓库"},value:null},data:function(){return{choosesValue:[],list:[]}},methods:{change:function(){this.$emit("input",this.choosesValue[this.choosesValue.length-1])}},watch:{value:{immediate:!0,handler:function(t){if(t){var e=function t(e,o,i){i.some((function(i){var r=i.children||[];if(i.id===o)return a=e,!0;if(r.length>0){var n=Object(s["a"])(e);return n.push(i.id),t(n,o,r)}}))},a=[];e([],t,this.list),this.choosesValue=[t].concat(Object(s["a"])(a)).sort()}else this.choosesValue=[]}}},beforeCreate:function(){var t=this;Object(r["e"])().then((function(e){200===e.code&&(t.list=e.data)})).catch((function(t){console.log(t)}))}},l=n,u=(a("1e31"),a("2877")),c=Object(u["a"])(l,o,i,!1,null,"1fa4dcec",null);e["default"]=c.exports},c8bb:function(t,e,a){t.exports=a("54a1")},d2d5:function(t,e,a){a("1654"),a("549b"),t.exports=a("584a").Array.from},f410:function(t,e,a){a("1af6"),t.exports=a("584a").Array.isArray}}]);